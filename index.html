<html lang="en">
<head>
<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Chore Tracker</title>
<style>
body {
@@ -19,31 +19,34 @@
flex-wrap: wrap;
}
.user-block {
      background: none;
      border: none;
      padding: 1em;
width: 260px;
}
h2 {
      font-size: 1.3em;
      margin-bottom: 0.5em;
      color: #ffda77;
text-align: center;
      color: #ffda77;
      margin-bottom: 0.5em;
}
    .button-row button, .paid-btn {
      font-size: 1.2em;
    .button-row {
      display: flex;
      justify-content: center;
      gap: 0.5em;
      margin: 0.5em 0;
    }
    .button-row button,
    .paid-btn,
    .edit-lifetime button {
      font-size: 1em;
padding: 0.4em 0.8em;
      margin: 0.4em;
border: none;
      border-radius: 8px;
      border-radius: 6px;
background-color: #444;
color: #fff;
cursor: pointer;
}
    .button-row {
      margin: 0.5em 0;
      display: flex;
      justify-content: center;
    .paid-btn {
      display: block;
      margin: 0.6em auto;
      background-color: #0066cc;
}
.chore-item {
display: flex;
@@ -62,16 +65,10 @@
margin-top: 0.8em;
color: #aad;
}
    .paid-btn {
      margin-top: 0.6em;
      background-color: #0066cc;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
.edit-lifetime {
margin-top: 0.8em;
text-align: center;
      display: none;
}
.edit-lifetime input {
width: 60px;
@@ -81,14 +78,14 @@
text-align: center;
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
getFirestore,
doc,
      getDoc,
updateDoc,
      onSnapshot,
      onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
@@ -105,151 +102,158 @@

const users = ["annabel", "amelia"];
const state = {};
    const checkedMap = {};
const todayStr = new Date().toISOString().split("T")[0];

    function render() {
      const container = document.getElementById("container");
      container.innerHTML = "";
    function getChoreKey(section, index) {
      return `${section}-${index}`;
    }

      users.forEach((user) => {
        const userData = state[user];
        if (!userData) return;
    function createChoreSection(user, sectionLabel, choreList, isPaid) {
      const section = document.createElement("div");
      const heading = document.createElement("h4");
      heading.textContent = sectionLabel;
      section.appendChild(heading);

        const wrapper = document.createElement("div");
        wrapper.className = "user-block";
      choreList.forEach((chore, i) => {
        const choreKey = getChoreKey(sectionLabel, i);
        const checked = state[user].checkedChores?.[choreKey] || false;

        const title = document.createElement("h2");
        title.textContent = user.charAt(0).toUpperCase() + user.slice(1) + "'s Chore Money";
        wrapper.appendChild(title);
        const item = document.createElement("div");
        item.className = "chore-item";

        const total = document.createElement("p");
        total.innerHTML = `Total: <span class="dollar">$${userData.total}</span>`;
        wrapper.appendChild(total);
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = choreKey;
        checkbox.checked = checked;

        const lifetime = document.createElement("p");
        lifetime.innerHTML = `Lifetime: <span class="dollar">$${userData.lifetime}</span>`;
        wrapper.appendChild(lifetime);
        const label = document.createElement("label");
        label.setAttribute("for", checkbox.id);
        label.textContent = chore;

        const btnRow = document.createElement("div");
        btnRow.className = "button-row";
        ["+", "-"].forEach((symbol) => {
          const btn = document.createElement("button");
          btn.textContent = symbol;
          btn.onclick = async () => {
            const delta = symbol === "+" ? 1 : -1;
            await updateDoc(doc(db, "users", user), {
              total: userData.total + delta,
            });
        checkbox.addEventListener("click", async () => {
          const newChecked = !checked;
          const updates = {
            [`checkedChores.${choreKey}`]: newChecked
};
          btnRow.appendChild(btn);
          if (isPaid) {
            updates.total = state[user].total + (newChecked ? 1 : -1);
          }
          await updateDoc(doc(db, "users", user), updates);
});
        wrapper.appendChild(btnRow);

        const choresList = (label, list, isPaid) => {
          const section = document.createElement("div");
          const heading = document.createElement("h4");
          heading.textContent = label;
          section.appendChild(heading);
        item.appendChild(checkbox);
        item.appendChild(label);
        section.appendChild(item);
      });

          list.forEach((chore, i) => {
            const item = document.createElement("div");
            item.className = "chore-item";
      return section;
    }

            const choreKey = `${user}-${label}-${i}`;
            if (!(choreKey in checkedMap)) checkedMap[choreKey] = false;
    function renderUserBlock(user) {
      const userData = state[user];
      const wrapper = document.createElement("div");
      wrapper.className = "user-block";
      wrapper.setAttribute("data-user", user);

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.id = choreKey;
            checkbox.checked = checkedMap[choreKey];
      const title = document.createElement("h2");
      title.textContent = `${user.charAt(0).toUpperCase() + user.slice(1)}'s Chore Money`;
      wrapper.appendChild(title);

            const labelEl = document.createElement("label");
            labelEl.setAttribute("for", checkbox.id);
            labelEl.textContent = chore;
      const total = document.createElement("p");
      total.innerHTML = `Total: <span class="dollar">$${userData.total}</span>`;
      wrapper.appendChild(total);

            checkbox.addEventListener("click", async () => {
              const newState = !checkedMap[choreKey];
              checkedMap[choreKey] = newState;
              checkbox.checked = newState;
              if (isPaid) {
                const delta = newState ? 1 : -1;
                await updateDoc(doc(db, "users", user), {
                  total: state[user].total + delta,
                });
              }
            });
      const lifetime = document.createElement("p");
      lifetime.innerHTML = `Lifetime: <span class="dollar">$${userData.lifetime}</span>`;
      wrapper.appendChild(lifetime);

            item.appendChild(checkbox);
            item.appendChild(labelEl);
            section.appendChild(item);
      const buttonRow = document.createElement("div");
      buttonRow.className = "button-row";
      ["+", "-"].forEach((symbol) => {
        const btn = document.createElement("button");
        btn.textContent = symbol;
        btn.onclick = async () => {
          const delta = symbol === "+" ? 1 : -1;
          await updateDoc(doc(db, "users", user), {
            total: userData.total + delta,
});
          return section;
};
        buttonRow.appendChild(btn);
      });
      wrapper.appendChild(buttonRow);

        wrapper.appendChild(choresList("Paid Chores", userData.paidChores, true));
        wrapper.appendChild(choresList("Required Chores", userData.requiredChores, false));
      wrapper.appendChild(createChoreSection(user, "Paid Chores", userData.paidChores, true));
      wrapper.appendChild(createChoreSection(user, "Required Chores", userData.requiredChores, false));

        const paidBtn = document.createElement("button");
        paidBtn.textContent = "Paid";
        paidBtn.className = "paid-btn";
        paidBtn.onclick = async () => {
          await updateDoc(doc(db, "users", user), {
            lifetime: userData.lifetime + userData.total,
            total: 0,
          });
        };
        wrapper.appendChild(paidBtn);
      const paidBtn = document.createElement("button");
      paidBtn.className = "paid-btn";
      paidBtn.textContent = "Paid";
      paidBtn.onclick = async () => {
        await updateDoc(doc(db, "users", user), {
          lifetime: userData.lifetime + userData.total,
          total: 0
        });
      };
      wrapper.appendChild(paidBtn);

        const adjustLifetime = document.createElement("div");
        adjustLifetime.className = "edit-lifetime";
        adjustLifetime.style.display = "none";
        const lifetimeLabel = document.createElement("label");
        lifetimeLabel.textContent = `Edit Lifetime:`;
        const lifetimeInput = document.createElement("input");
        lifetimeInput.type = "number";
        lifetimeInput.value = userData.lifetime;
        const saveBtn = document.createElement("button");
        saveBtn.textContent = "Save";
        saveBtn.onclick = async () => {
          const newVal = parseInt(lifetimeInput.value);
          if (!isNaN(newVal)) {
            await updateDoc(doc(db, "users", user), {
              lifetime: newVal,
            });
          }
        };
        adjustLifetime.appendChild(lifetimeLabel);
        adjustLifetime.appendChild(lifetimeInput);
        adjustLifetime.appendChild(saveBtn);
        wrapper.appendChild(adjustLifetime);
      const adjustLifetime = document.createElement("div");
      adjustLifetime.className = "edit-lifetime";
      const lifetimeLabel = document.createElement("label");
      lifetimeLabel.textContent = "Edit Lifetime:";
      const lifetimeInput = document.createElement("input");
      lifetimeInput.type = "number";
      lifetimeInput.value = userData.lifetime;
      const saveBtn = document.createElement("button");
      saveBtn.textContent = "Save";
      saveBtn.onclick = async () => {
        const newVal = parseInt(lifetimeInput.value);
        if (!isNaN(newVal)) {
          await updateDoc(doc(db, "users", user), { lifetime: newVal });
        }
      };
      adjustLifetime.appendChild(lifetimeLabel);
      adjustLifetime.appendChild(lifetimeInput);
      adjustLifetime.appendChild(saveBtn);
      wrapper.appendChild(adjustLifetime);

      return wrapper;
    }

        wrapper.setAttribute("data-user", user);
        container.appendChild(wrapper);
    function renderAll() {
      const container = document.getElementById("container");
      container.innerHTML = "";
      users.forEach(user => {
        if (state[user]) {
          container.appendChild(renderUserBlock(user));
        }
});
}

    users.forEach(async (user) => {
    users.forEach((user) => {
const ref = doc(db, "users", user);
      const snap = await getDoc(ref);
      const data = snap.data();
      onSnapshot(ref, async (docSnap) => {
        const data = docSnap.data();

      if (data.lastReset !== todayStr) {
        await updateDoc(ref, { lastReset: todayStr });
        for (let key in checkedMap) {
          if (key.startsWith(user + "-")) {
            checkedMap[key] = false;
        // Handle daily reset
        if (data.lastReset !== todayStr) {
          const resetChores = {};
          for (let key in data.checkedChores || {}) {
            resetChores[`checkedChores.${key}`] = false;
}
          await updateDoc(ref, {
            ...resetChores,
            lastReset: todayStr
          });
          return;
}
      }

      onSnapshot(ref, (docSnap) => {
        state[user] = docSnap.data();
        render();
        state[user] = data;
        renderAll();
});
});

    document.addEventListener("keydown", async (e) => {
    // Secret key to edit lifetime values
    document.addEventListener("keydown", (e) => {
if (e.shiftKey && e.key.toLowerCase() === "l") {
document.querySelectorAll(".edit-lifetime").forEach(el => el.style.display = "block");
}
